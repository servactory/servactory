# План реализации новой конфигурации в Servactory

## Цель проекта
Перенести всю конфигурацию сервиса из класса в инстанс класса через `Warehouse::Setup` с поддержкой наследования и дефолтных значений.

## Этапы реализации

### Этап 1: Анализ текущей архитектуры
- [x] Изучить текущую структуру `lib/servactory/context/warehouse/setup.rb`
- [x] Проанализировать существующие `inputs`, `internals`, `outputs` в `Warehouse::Setup`
- [x] Изучить текущую систему конфигурации в `lib/servactory/configuration/`
- [x] Определить интерфейсы взаимодействия с конфигурацией

### Этап 2: Проектирование новой архитектуры
- [x] Спроектировать структуру атрибута `configuration` в `Warehouse::Setup`
- [x] Определить механизм наследования конфигурации между классами
- [x] Спроектировать систему сборки конфигурации (дефолты + пользовательские значения)
- [x] Определить интерфейс доступа к конфигурации через `servactory_service_warehouse`

### Этап 3: Реализация базовой функциональности
- [x] Добавить атрибут `configuration` в `Warehouse::Setup`
- [x] Реализовать хранение дефолтных значений конфигурации
- [x] Создать механизм объединения дефолтных и пользовательских значений
- [x] Обеспечить размещение конфигурации в `servactory_service_warehouse`

### Этап 4: Реализация наследования
- [x] Реализовать наследование конфигурации от родительских классов
- [x] Обеспечить правильный порядок приоритетов: дефолты → родительская конфигурация → текущая конфигурация
- [x] Создать механизм переопределения унаследованных значений

### Этап 5: Интеграция с существующей системой
- [x] Обновить все места использования конфигурации для работы с новой системой
- [x] Обеспечить обратную совместимость с существующими сервисами
- [x] Обновить DSL для работы с новой конфигурацией

## Ключевые файлы для изменения

### Основные файлы
- `lib/servactory/context/warehouse/setup.rb` - добавление атрибута `configuration`
- `lib/servactory/configuration/` - возможные изменения в системе конфигурации
- `lib/servactory/base.rb` - интеграция с базовым классом сервисов
- `lib/servactory/dsl.rb` - обновление DSL для работы с конфигурацией

### Тесты
- Тесты примеров использования в `spec/examples/`

## Риски и ограничения

### Технические риски
- Нарушение обратной совместимости с существующими сервисами
- Сложность реализации корректного наследования конфигурации
- Возможные проблемы производительности при сборке конфигурации

### Пути митигации
- Пошаговая реализация с сохранением обратной совместимости
- Тщательное тестирование всех сценариев наследования
- Оптимизация процесса сборки конфигурации с кэшированием

## Критерии готовности

### Must Have
- [x] Атрибут `configuration` работает в `Warehouse::Setup`
- [x] Конфигурация доступна через `servactory_service_warehouse`
- [x] Работает наследование между классами
- [x] Все существующие тесты проходят

### Should Have
- [x] Производительность не хуже текущей реализации
- [x] Интерфейс использования конфигурации остается прежним

### Could Have
- [ ] Дополнительные утилиты для работы с конфигурацией
- [ ] Валидация конфигурации
- [ ] Расширенные возможности наследования

## Следующие шаги

1. Начать с детального изучения файла `lib/servactory/context/warehouse/setup.rb`
2. Проанализировать текущую систему конфигурации
3. Создать proof-of-concept для атрибута `configuration`
4. Реализовать базовую функциональность пошагово
