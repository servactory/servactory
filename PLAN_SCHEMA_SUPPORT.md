# План внедрения поддержки опции `schema` для динамической опции `consists_of`

## Цель
Добавить поддержку опции `schema` для атрибутов с типом `Array` и `consists_of: Hash`, чтобы можно было валидировать структуру каждого элемента массива по заданной схеме.

## Этапы

### 1. Анализ текущей реализации
- Изучить класс `ConsistsOf` и понять, где происходит проверка типа элементов коллекции.
- Убедиться, что текущая логика не нарушится при добавлении новой опции.

### 2. Анализ примеров
- Изучить примеры использования `consists_of` в `examples/usual/dynamic_options/consists_of`.
- Зафиксировать все кейсы, которые должны остаться рабочими.

### 3. Проектирование поддержки `schema`
- Опция `schema` должна работать только если:
  - `type: Array` (или Set, если потребуется)
  - `consists_of: Hash`
- Для каждого элемента массива, если он Hash, должна выполняться валидация по схеме.
- Схема задается в виде хеша: `{ ключ: { type: ..., required: ... }, ... }`.
- Валидация должна проверять:
  - Наличие обязательных ключей (`required: true`)
  - Соответствие типа значения ключа (`type: ...`)

### 4. Изменения в коде
- В классе `ConsistsOf`:
  - Добавить обработку опции `schema` в методе валидации элементов коллекции.
  - Реализовать вспомогательный метод для валидации одного элемента Hash по схеме.
  - Не нарушать текущую логику для других типов и опций.
- Добавить/обновить сообщения об ошибках для schema.

### 5. Примеры
- Добавить примеры использования новой опции `schema` в `examples/usual/dynamic_options/consists_of`.
- Пример:
  ```ruby
  input :items, type: Array, consists_of: Hash, schema: {
    id: { type: String, required: true },
    name: { type: String, required: true }
  }
  ```

### 6. Тесты
- Добавить/обновить тесты для проверки новой функциональности schema.
- Проверить, что не нарушен существующий функционал.

### 7. Рефакторинг и проверка
- Провести рефакторинг, если потребуется.
- Убедиться, что весь функционал работает корректно и обратная совместимость сохранена.

---

**После выполнения всех этапов — задача считается завершённой.** 